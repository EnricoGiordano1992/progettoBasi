DROP TABLE SPEC_DEL_MEDICO;
DROP TABLE SPECIALIZZAZIONI;
DROP TABLE CONTRADDIZIONI;
DROP TABLE CONFERME;
DROP TABLE DIAGNOSI;
DROP TABLE MEDICO;
DROP TABLE SINTOMI;
DROP TABLE RISCHI_PAZIENTE;
DROP TABLE FATTORI_RISCHIO;
DROP TABLE TERAPIE;
DROP TABLE CARTELLA_CLINICA;
DROP TABLE PAZIENTE;



----------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
-------------------------------------              PAZIENTE             ----------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------------------

CREATE TABLE PAZIENTE (

    CODSAN              VARCHAR(30)     NOT NULL,
    NOME                VARCHAR(30)     NOT NULL,
    COGNOME             VARCHAR(30)     NOT NULL,
    NASCITA             DATE            NOT NULL,
    PSW                 VARCHAR(30)     NOT NULL,
    CITTA               VARCHAR(30)     NOT NULL,
    VIA                 VARCHAR(30)     NOT NULL,
    PROV                VARCHAR(30)     NOT NULL,
    CAP                 INT             NOT NULL,
    -- varchar per gestire i civici tipo 10/b
    CIVICO              VARCHAR(10)     NOT NULL,
    
    PRIMARY KEY(CODSAN)
);



----------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
-------------------------------------        CARTELLA CLINICA           ----------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------------------


CREATE TABLE CARTELLA_CLINICA (

    ID                  VARCHAR(30)     NOT NULL,
    DATA_RICOVERO       DATE            NOT NULL,
    DATA_DIMISSIONE     DATE            NOT NULL,
    MOTIVO              VARCHAR(150)     NOT NULL,
    PROGNOSI            VARCHAR(150)             ,
    CODSAN              VARCHAR(30)     REFERENCES PAZIENTE(CODSAN),

    PRIMARY KEY(ID)
);



----------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
-------------------------------------             TERAPIE               ----------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------------------


CREATE TABLE TERAPIE (

    ID_CARTELLA         VARCHAR(30)     NOT NULL,
    INIZIO              DATE            NOT NULL,
    FINE                DATE            NOT NULL,
    FREQUENZA           INT             NOT NULL,
    DOSE                FLOAT(5)        NOT NULL,
    FARMACO             VARCHAR(30)     NOT NULL,
    
    FOREIGN KEY(ID_CARTELLA) REFERENCES CARTELLA_CLINICA(ID)
);


----------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
-------------------------------------        FATTORI_RISCHIO            ----------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------------------


CREATE TABLE FATTORI_RISCHIO (

    NOME                VARCHAR(30)     PRIMARY KEY

);



----------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
-------------------------------------        RISCHI_PAZIENTE            ----------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------------------


CREATE TABLE RISCHI_PAZIENTE (

    ID_PAZIENTE         VARCHAR(30)     NOT NULL,
    NOME_FATTORE        VARCHAR(30)     NOT NULL, 

    FOREIGN KEY(ID_PAZIENTE) REFERENCES PAZIENTE(CODSAN),
    FOREIGN KEY(NOME_FATTORE) REFERENCES FATTORI_RISCHIO(NOME)
);



----------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
-------------------------------------             SINTOMI               ----------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------------------


CREATE TABLE SINTOMI (

    ID_PAZIENTE         VARCHAR(30)     REFERENCES PAZIENTE(CODSAN),
    NOME                VARCHAR(30)     NOT NULL,
    INTENSITA           VARCHAR(30)     NOT NULL,


    PRIMARY KEY         (NOME, ID_PAZIENTE),
--    FOREIGN KEY (ID_PAZIENTE) ,
    CHECK(INTENSITA IN  ('bassa', 'media', 'alta'))

);



----------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
-------------------------------------             MEDICO                ----------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------------------


CREATE TABLE MEDICO (

    ID                  VARCHAR(30)     NOT NULL,
    NOME                VARCHAR(30)     NOT NULL,
    COGNOME             VARCHAR(30)     NOT NULL,
    PRIMARIO            VARCHAR(30)     NOT NULL,
    PSW                 VARCHAR(30)     NOT NULL,
    INIZIO_ATTIVITA     DATE            NOT NULL,

    PRIMARY KEY(ID)
);



----------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
-------------------------------------            DIAGNOSI               ----------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------------------


CREATE TABLE DIAGNOSI (

    ID_PAZIENTE         VARCHAR(30)     REFERENCES PAZIENTE(CODSAN),
    DATA                DATE            NOT NULL,
    ICD10               VARCHAR(30)     NOT NULL,
    PATOLOGIA           VARCHAR(30)     NOT NULL,
    ID_MEDICO           VARCHAR(30)     REFERENCES MEDICO(ID),

    PRIMARY KEY (ID_PAZIENTE, DATA)
);



----------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
-------------------------------------            CONFERME               ----------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------------------

CREATE TABLE CONFERME (

    ID_SINTOMO          VARCHAR(30)     NOT NULL,
    N_PAT               VARCHAR(30)     NOT NULL,
    ID_DIAGNOSI         VARCHAR(30)     NOT NULL,
    DATA                DATE            NOT NULL,

    FOREIGN KEY(ID_SINTOMO, N_PAT) REFERENCES SINTOMI(ID_PAZIENTE, NOME),
    FOREIGN KEY(ID_DIAGNOSI, DATA) REFERENCES DIAGNOSI(ID_PAZIENTE, DATA)

);




----------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
-------------------------------------          CONTRADDIZIONI           ----------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------------------


CREATE TABLE CONTRADDIZIONI (

    ID_SINTOMO          VARCHAR(30)     NOT NULL,
    N_PAT               VARCHAR(30)     NOT NULL,
    ID_DIAGNOSI         VARCHAR(30)     NOT NULL,
    DATA                DATE            NOT NULL,

    FOREIGN KEY(ID_SINTOMO, N_PAT) REFERENCES SINTOMI(ID_PAZIENTE, NOME),
    FOREIGN KEY(ID_DIAGNOSI, DATA) REFERENCES DIAGNOSI(ID_PAZIENTE, DATA)

);


----------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
-------------------------------------         SPECIALIZZAZIONI          ----------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------------------


CREATE TABLE SPECIALIZZAZIONI (

    NOME                VARCHAR(30)     PRIMARY KEY   

);



----------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
-------------------------------------          SPEC_DEL_MEDICO          ----------------------------------------------------------------
-------------------------------------                                   ----------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------------------


CREATE TABLE SPEC_DEL_MEDICO (

    ID_MEDICO               VARCHAR(30)     NOT NULL,
    NOME_SPECIALIZZAZIONE   VARCHAR(30)     NOT NULL,

    FOREIGN KEY(ID_MEDICO) REFERENCES MEDICO(ID),
    FOREIGN KEY(NOME_SPECIALIZZAZIONE) REFERENCES SPECIALIZZAZIONI(NOME)
);
